<template>
  <div class="item-subtypes-selection">
    <heading :text="$t('availableItems')" />
    <ul class="item-subtypes" v-if="itemSubtypes && itemSubtypes.length">
      <li
        class="item-subtype"
        v-for="itemSubtype of itemSubtypes"
        :key="itemSubtype.id"
      >
        <item-subtype-selection :itemSubtypeRaw="itemSubtype" />
      </li>
    </ul>
    <template v-else>
      <div class="no-item-subtypes">
        <a-empty :image="$empty.PRESENTED_IMAGE_SIMPLE" />
      </div>
    </template>
  </div>
</template>

<script>
import { mapActions, mapState } from "vuex";
import Heading from "../views/Heading.vue";
import ItemSubtypeSelection from "./ItemSubtypeSelection.vue";

export default {
  name: "ItemSubtypesSelection",

  components: { ItemSubtypeSelection, Heading },

  computed: {
    ...mapState(["startTime", "endTime"]),
    ...mapState("locationModule", ["selectedLocation"]),
    ...mapState("itemTypeModule", ["selectedItemType"]),
    ...mapState("itemSubtypeModule", ["itemSubtypes"])
  },

  watch: {
    startTime() {
      this.loadItemSubtypes();
    },

    endTime() {
      this.loadItemSubtypes();
    },

    selectedLocation() {
      this.loadItemSubtypes();
    },

    selectedItemType() {
      this.loadItemSubtypes();
    }
  },

  methods: {
    ...mapActions("itemSubtypeModule", ["getItemSubtypes", "setItemSubtypes"]),

    loadItemSubtypes() {
      if (
        this.selectedLocation &&
        this.selectedItemType &&
        this.selectedItemType.id &&
        this.startTime &&
        this.endTime
      ) {
        this.getItemSubtypes({
          locationId: this.selectedLocation,
          itemTypeId: this.selectedItemType.id,
          startTime: this.startTime,
          endTime: this.endTime
        });
      } else {
        this.setItemSubtypes([]);
      }
    }
  }
};
</script>

<style scoped>
.item-subtypes-selection {
  width: 100%;
  height: auto;
  margin: 30px 0;
}

ul.item-subtypes {
  list-style-type: none;
  margin: 0px;
  padding: 5px;
  border: 1px solid #e8e8e8;
  border-radius: 5px;
  overflow: hidden;
  overflow-y: auto;
  height: auto;
  max-height: 400px;
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' version='1.1' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns:svgjs='http://svgjs.com/svgjs' width='1440' height='560' preserveAspectRatio='none' viewBox='0 0 1440 560'%3e%3cg mask='url(%26quot%3b%23SvgjsMask1011%26quot%3b)' fill='none'%3e%3cpath d='M230 0C256.06 3.48 260.6 1.24 280 18.67C338.51 71.24 336.39 76.82 385.81 140C406.39 166.31 398.38 172.41 420 197.65C458.33 242.41 460.13 242.36 505.71 280C530.13 300.16 533 313.25 560 313.25C586.23 313.25 604.7 306.54 612.16 280C629.05 219.91 610.6 210 608.7 140C606.8 70 577.4 41.63 604.55 0C623.05 -28.37 652.28 0 700 0C770 0 770 0 840 0C910 0 910 0 980 0C1050 0 1050 0 1120 0C1190 0 1190 0 1260 0C1330 0 1330 0 1400 0C1470 0 1505 -35 1540 0C1575 35 1540 70 1540 140C1540 210 1540 210 1540 280C1540 350 1540 350 1540 420C1540 490 1563.33 513.33 1540 560C1528.33 583.33 1499.32 574.1 1470 560C1429.32 540.44 1431.33 492.69 1400 492.69C1373.9 492.69 1387.3 544.53 1355.13 560C1317.3 578.19 1307.57 560 1260 560C1201.11 560 1194.67 572.2 1142.22 560C1124.67 555.92 1133.03 527.44 1120 527.44C1103.97 527.44 1106.34 554.83 1084.1 560C1036.34 571.11 1032.05 560 980 560C910 560 910 560 840 560C784.59 560 783.92 563.97 729.17 560C713.92 558.9 715.14 549.86 700 549.86C656.81 549.86 656.36 556.82 612.5 560C586.36 561.89 586.25 560 560 560C490 560 490 560 420 560C367.5 560 329.74 589.48 315 560C294.74 519.48 344.68 490.89 350 420C355.18 350.89 359.94 339.15 336 280C324.94 252.68 308.07 247.06 280 247.06C251.5 247.06 225.34 253.08 222.86 280C217.37 339.55 250.11 348.71 264.05 420C277.49 488.71 308.98 524.62 277.63 560C246.95 594.62 208.81 560 140 560C70 560 35 595 0 560C-35 525 0 490 0 420C0 350 0 350 0 280C0 210 0 210 0 140C0 70 -35 35 0 0C35 -35 70 0 140 0C185 0 186.06 -5.86 230 0' stroke='rgba(238%2c 238%2c 238%2c 1)' stroke-width='2'%3e%3c/path%3e%3cpath d='M980 103.87C958.26 112.7 947.54 121.01 947.54 140C947.54 161.93 955.92 184.45 980 185.71C1042.15 188.96 1050.53 168.88 1120 149.03C1130.53 146.02 1140 149.15 1140 140C1140 109.64 1146.86 76.07 1120 70C1066.86 58 1044.49 77.7 980 103.87' stroke='rgba(238%2c 238%2c 238%2c 1)' stroke-width='2'%3e%3c/path%3e%3cpath d='M1400 150C1367.34 150 1319.11 221.32 1319.11 280C1319.11 320.66 1364.91 348.68 1400 348.68C1426.76 348.68 1442.82 316.91 1442.82 280C1442.82 217.57 1429.2 150 1400 150' stroke='rgba(238%2c 238%2c 238%2c 1)' stroke-width='2'%3e%3c/path%3e%3cpath d='M1260 386.4C1248.57 386.4 1238.46 405.48 1238.46 420C1238.46 429.4 1248.97 434.24 1260 434.24C1272.46 434.24 1285.45 429.78 1285.45 420C1285.45 405.86 1272.07 386.4 1260 386.4' stroke='rgba(238%2c 238%2c 238%2c 1)' stroke-width='2'%3e%3c/path%3e%3cpath d='M99.17 0C120.96 2.88 118.94 10.88 140 18.49C209.36 43.55 218.63 28.97 280 65.33C321.19 89.73 345.12 103.68 345.12 140C345.12 173.96 317.22 178.98 280 205.88C220.37 248.98 166.13 227.77 151.43 280C136 334.83 202.14 346.27 219.75 420C235.58 486.27 243.88 515.11 218.31 560C204.01 585.11 179.15 560 140 560C74 560 72.4 563.79 8 560C2.4 559.67 0.32 557.37 0 551.76C-3.68 487.37 0 485.88 0 420C0 350 0 350 0 280C0 210 0 210 0 140C0 70 -29.02 40.98 0 0C20.56 -29.02 50.96 -6.37 99.17 0' stroke='rgba(238%2c 238%2c 238%2c 1)' stroke-width='2'%3e%3c/path%3e%3cpath d='M736.84 140C709.79 83.89 707.14 40.3 736.84 0C758.72 -29.7 788.42 0 840 0C910 0 910 0 980 0C1015 0 1050 -10.74 1050 0C1050 12.97 1010.98 19.1 980 47.42C934.39 89.1 936.83 92.4 896.81 140C866.83 175.67 873.88 213.96 840 213.96C793.89 213.96 761.37 190.87 736.84 140' stroke='rgba(238%2c 238%2c 238%2c 1)' stroke-width='2'%3e%3c/path%3e%3cpath d='M1260 135.88C1217.77 135.88 1174.44 44.32 1174.44 0C1174.44 -23.62 1217.22 0 1260 0C1301.25 0 1342.5 -23.21 1342.5 0C1342.5 44.73 1301.8 135.88 1260 135.88' stroke='rgba(238%2c 238%2c 238%2c 1)' stroke-width='2'%3e%3c/path%3e%3cpath d='M1482.56 140C1493.69 97.83 1523.89 67.74 1540 67.74C1552.61 67.74 1540 103.87 1540 140C1540 210 1540 210 1540 280C1540 350 1540 350 1540 420C1540 490 1569.32 558.87 1540 560C1499.32 561.56 1470.59 491.94 1400 425.38C1396.35 421.94 1391.52 422.67 1391.52 420C1391.52 417.34 1397.26 418.86 1400 414.72C1443.5 348.86 1462.06 352.99 1484 280C1503.34 215.63 1465.69 203.96 1482.56 140' stroke='rgba(238%2c 238%2c 238%2c 1)' stroke-width='2'%3e%3c/path%3e%3cpath d='M406 280C406 271.73 412.96 266.27 420 266.27C427.11 266.27 434.29 271.69 434.29 280C434.29 295.22 427.08 313.33 420 313.33C412.94 313.33 406 295.26 406 280' stroke='rgba(238%2c 238%2c 238%2c 1)' stroke-width='2'%3e%3c/path%3e%3cpath d='M680.78 280C701.63 259.95 687.98 222.35 700 222.35C712.91 222.35 706.88 259.23 730.63 280C776.88 320.46 788.32 308.2 840 344.81C887.13 378.2 894.52 374.56 928.26 420C964.52 468.82 953.41 477.02 980 533.33C986.46 547.02 994.36 550.95 994.36 560C994.36 564.29 987.18 560 980 560C952 560 951.34 564.69 924 560C881.34 552.69 882.15 547.45 840 536C770.15 517.02 771.12 506.52 700 499.13C631.12 491.97 621.43 527.42 560 506.9C502.97 487.85 463.08 459.7 463.08 420C463.08 384.75 511.39 388.26 560 357C620.24 318.26 631.63 327.27 680.78 280' stroke='rgba(238%2c 238%2c 238%2c 1)' stroke-width='2'%3e%3c/path%3e%3cpath d='M946.06 280C946.06 265.75 961.28 265.16 980 257.14C1048.25 227.9 1053.31 199.58 1120 205.48C1182.54 211.01 1231.9 230.98 1238.46 280C1246.26 338.24 1196.75 352.67 1148.72 420C1137.52 435.7 1135.73 446.05 1120 446.05C1098.97 446.05 1094.66 436.85 1075.2 420C1024.66 376.22 1025.55 374.18 980 324.8C960.98 304.18 946.06 299.58 946.06 280' stroke='rgba(238%2c 238%2c 238%2c 1)' stroke-width='2'%3e%3c/path%3e%3cpath d='M1197.78 560C1197.78 540.27 1230.64 493.56 1260 493.56C1286.88 493.56 1310.26 539.28 1310.26 560C1310.26 572.5 1285.13 560 1260 560C1228.89 560 1197.78 573.49 1197.78 560' stroke='rgba(238%2c 238%2c 238%2c 1)' stroke-width='2'%3e%3c/path%3e%3cpath d='M0 112C58.52 88.82 70 84.53 140 84.53C210 84.53 214.78 90 280 112C296.99 117.73 304.42 126.38 304.42 140C304.42 152.74 295.7 158.02 280 164.71C213.49 193.02 204.71 177.43 140 210C90.17 235.08 50.91 244.74 50.91 280C50.91 315.59 102.78 309.86 140 351.71C165.04 379.86 172.09 383.23 175.44 420C181.58 487.37 174.6 498.31 158.98 560C156.88 568.31 149.49 560 140 560C124 560 119.98 569.51 108 560C49.98 513.92 45.53 507.85 0 448.82C-8.47 437.85 0 434.41 0 420C0 350 0 350 0 280C0 210 0 210 0 140C0 126 -11.48 116.55 0 112' stroke='rgba(238%2c 238%2c 238%2c 1)' stroke-width='2'%3e%3c/path%3e%3cpath d='M828.95 140C823.91 72.59 823.83 64.88 828.95 0C829.35 -5.12 834.47 0 840 0C870 0 899.13 -20 900 0C902.18 50 874.22 70.66 846.09 140C844.22 144.62 843.63 147.92 840 147.92C835.06 147.92 829.44 146.55 828.95 140' stroke='rgba(238%2c 238%2c 238%2c 1)' stroke-width='2'%3e%3c/path%3e%3cpath d='M1260 32.94C1249.76 32.94 1239.26 10.74 1239.26 0C1239.26 -5.73 1249.63 0 1260 0C1270 0 1280 -5.63 1280 0C1280 10.84 1270.13 32.94 1260 32.94' stroke='rgba(238%2c 238%2c 238%2c 1)' stroke-width='2'%3e%3c/path%3e%3cpath d='M1075.2 280C1075.2 266.4 1098.41 261.94 1120 261.94C1135.17 261.94 1148.72 267.76 1148.72 280C1148.72 299.19 1136.78 324.8 1120 324.8C1100.02 324.8 1075.2 297.83 1075.2 280' stroke='rgba(238%2c 238%2c 238%2c 1)' stroke-width='2'%3e%3c/path%3e%3cpath d='M1525.18 280C1527.91 244.49 1536.25 210 1540 210C1543.66 210 1540 245 1540 280C1540 350 1540 350 1540 420C1540 427.5 1543.27 435 1540 435C1535.19 435 1524.86 430.54 1523.85 420C1517.45 353.04 1519.84 349.49 1525.18 280' stroke='rgba(238%2c 238%2c 238%2c 1)' stroke-width='2'%3e%3c/path%3e%3cpath d='M530.38 420C530.38 409.23 543.49 406.71 560 400.75C628.3 376.09 630.66 356.55 700 358.75C770.66 360.99 771.29 381.97 840 409.63C847.38 412.6 852.17 414.16 852.17 420C852.17 427.34 849.52 434.22 840 436C773.44 448.43 770.13 445.77 700 448.41C630.13 451.04 626.05 457.61 560 446.55C541.24 443.41 530.38 432.13 530.38 420' stroke='rgba(238%2c 238%2c 238%2c 1)' stroke-width='2'%3e%3c/path%3e%3cpath d='M1253.33 560C1253.33 557.89 1256.85 552.88 1260 552.88C1262.88 552.88 1265.38 557.78 1265.38 560C1265.38 561.34 1262.69 560 1260 560C1256.66 560 1253.33 561.45 1253.33 560' stroke='rgba(238%2c 238%2c 238%2c 1)' stroke-width='2'%3e%3c/path%3e%3c/g%3e%3cdefs%3e%3cmask id='SvgjsMask1011'%3e%3crect width='1440' height='560' fill='white'%3e%3c/rect%3e%3c/mask%3e%3c/defs%3e%3c/svg%3e");
}

li.item-subtype {
  width: 100%;
  height: auto;
  margin: 12px 5px;
}
</style>
